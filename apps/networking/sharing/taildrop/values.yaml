---
# yaml-language-server: $schema=https://raw.githubusercontent.com/bjw-s/helm-charts/common-3.0.1/charts/library/common/values.schema.json
controllers:
  taildrop:
    pod:
      securityContext:
        fsGroup: 979
        fsGroupChangePolicy: "OnRootMismatch"

    containers:
      tailscale:
        image:
          repository: tailscale/tailscale
          tag: v1.62.1
          pullPolicy: IfNotPresent
        env:
          TS_STATE_DIR: "/var/lib/tailscale"
          TS_KUBE_SECRET: ""
          TS_HOSTNAME: "tailscalequail"
          TS_EXTRA_ARGS: "--ssh"
        envFrom:
          - secretRef:
              name: tailscale-authkey
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            add:
              - NET_ADMIN

persistence:
  state:
    enabled: true
    type: persistentVolumeClaim
    storageClass: ceph-block
    size: 1Gi
    accessMode: ReadWriteOnce
    advancedMounts:
      taildrop:
        tailscale:
          - path: /var/lib/tailscale
  share:
    enabled: true
    type: nfs
    server: peepums
    path: /pool01/media/plex
    advancedMounts:
      taildrop:
        tailscale:
          - path: /share
            readOnly: true
