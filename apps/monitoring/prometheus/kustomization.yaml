apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- "namespace.yaml"

helmCharts:
- name: prometheus-operator-crds
  repo: https://prometheus-community.github.io/helm-charts
  version: 5.0.0
  releaseName: prometheus-operator-crds
  namespace: prometheus
- name: kube-prometheus-stack
  repo: https://prometheus-community.github.io/helm-charts
  version: 48.1.1
  releaseName: kube-prometheus-stack
  namespace: prometheus

patches:
- patch: |-
    apiVersion: v1
    kind: Service
    metadata:
      name: kube-prometheus-stack-grafana
    spec:
      type: LoadBalancer
  target:
    kind: Service
    name: "kube-prometheus-stack-grafana"
- patch: |-
    apiVersion: v1
    kind: Service
    metadata:
      name: kube-prometheus-stack-prometheus
    spec:
      type: LoadBalancer
  target:
    kind: Service
    name: "kube-prometheus-stack-prometheus"
